name: Build OpenWrt 23.05 for ZTE B860H V1 (S905)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout source
      uses: actions/checkout@v4

    - name: Set build environment
      run: |
        sudo apt update
        sudo apt install -y \
          git wget curl unzip gzip \
          build-essential \
          libncurses-dev gawk flex bison \
          python3 python3-distutils rsync \
          ca-certificates

    - name: Build OpenWrt (Amlogic S905)
      run: |
        chmod +x build.sh
        ./build.sh \
          -v 23.05 \
          -k 5.15 \
          -s s905 \
          -d b860h

    - name: Upload firmware
      uses: actions/upload-artifact@v4
      with:
        name: openwrt-b860h-23.05
        path: out/*.img.gz
